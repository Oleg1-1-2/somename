-- первоночальная прогрузка решения
 
insert into HLOV_DWH_DIM_CARDS_HIST
	(CARD_NUM, ACCOUNT_NUM, EFFECTIVE_FROM)
select CARD_NUM, ACCOUNT, coalesce(UPDATE_DT,CREATE_DT) 
from BANK.CARDS;
  
insert into HLOV_DWH_DIM_ACCOUNTS_HIST
	(ACCOUNT_NUM, VALID_TO, CLIENT, EFFECTIVE_FROM)
select ACCOUNT, VALID_TO, CLIENT, coalesce(UPDATE_DT,CREATE_DT) 
from BANK.ACCOUNTS;

insert into HLOV_DWH_DIM_CLIENTS_HIST
   (CLIENT_ID, LAST_NAME, FIRST_NAME, PATRONYMIC, 
	DATE_OF_BIRTH, PASSPORT_NUM, PASSPORT_VALID_TO, 
	PHONE, EFFECTIVE_FROM)
select CLIENT_ID, LAST_NAME, FIRST_NAME, PATRONYMIC, 
	   DATE_OF_BIRTH, PASSPORT_NUM, PASSPORT_VALID_TO, 
	   PHONE, coalesce(UPDATE_DT,CREATE_DT)
from BANK.CLIENTS;

 -- обновление метаданных
 
insert into HLOV_META_CARDS (LAST_UPDATE_DT) 
	select max(EFFECTIVE_FROM) from HLOV_DWH_DIM_CARDS_HIST; 

insert into HLOV_META_ACCOUNTS (LAST_UPDATE_DT) 
	select max(EFFECTIVE_FROM) from HLOV_DWH_DIM_ACCOUNTS_HIST; 

insert into HLOV_META_CLIENTS (LAST_UPDATE_DT) 
	select max(EFFECTIVE_FROM) from HLOV_DWH_DIM_CLIENTS_HIST;

insert into HLOV_META_PASSPORT_BLACKLIST (LAST_UPDATE_DT) 
	values (to_date('1900-01-01'));	

insert into HLOV_META_TRANSACTIONS (LAST_UPDATE_DT) 
	values (to_date('1900-01-01'));		


commit;
